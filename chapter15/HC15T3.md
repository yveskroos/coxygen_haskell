{-# LANGUAGE DeriveDataTypeable #-}

module Main where

import Control.Exception
import Data.Typeable

-- Définition d'une exception personnalisée
data TrafficLightException = InvalidLight String
    deriving (Show, Typeable)

instance Exception TrafficLightException

-- Type des feux tricolores
data TrafficLight = Red | Yellow | Green deriving (Show, Read, Eq)

-- Fonction qui décide l'action de la voiture
action :: TrafficLight -> String
action Red    = "Arrêter la voiture !"
action Yellow = "Ralentir !"
action Green  = "Avancer !"

-- Lecture et validation du feu
readLight :: IO TrafficLight
readLight = do
    putStrLn "Entrez la couleur du feu (Red, Yellow, Green) :"
    input <- getLine
    case reads input :: [(TrafficLight, String)] of
        [(light, "")] -> return light
        _             -> throwIO (InvalidLight input)  -- Lancer l’exception

main :: IO ()
main = do
    result <- try readLight :: IO (Either TrafficLightException TrafficLight)
    case result of
        Left (InvalidLight s) -> putStrLn $ "Erreur : '" ++ s ++ "' n'est pas un feu valide !"
        Right light           -> putStrLn $ "Décision : " ++ action light

