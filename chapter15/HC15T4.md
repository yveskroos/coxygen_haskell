
{-# LANGUAGE DeriveDataTypeable #-}

module Main where

import Control.Exception
import Data.Typeable

-- Exception personnalisée
data TrafficLightException = InvalidLight String
    deriving (Show, Typeable)

instance Exception TrafficLightException

-- Type des feux tricolores
data TrafficLight = Red | Yellow | Green deriving (Show, Read, Eq)

-- Décision de la voiture
action :: TrafficLight -> String
action Red    = "Arrêter la voiture !"
action Yellow = "Ralentir !"
action Green  = "Avancer !"

-- Lecture d’un feu
readLight :: IO TrafficLight
readLight = do
    putStrLn "Entrez la couleur du feu (Red, Yellow, Green) :"
    input <- getLine
    case reads input :: [(TrafficLight, String)] of
        [(light, "")] -> return light
        _             -> throwIO (InvalidLight input)

-- Gestionnaire d’exception : retourne un feu "par défaut"
handleTrafficException :: TrafficLightException -> IO TrafficLight
handleTrafficException (InvalidLight s) = do
    putStrLn $ "⚠ Erreur : '" ++ s ++ "' n'est pas une couleur de feu valide !"
    putStrLn "On considère que le feu est Rouge par sécurité."
    return Red

-- Programme principal
main :: IO ()
main = do
    light <- readLight `catch` handleTrafficException
    putStrLn $ "Décision : " ++ action light
