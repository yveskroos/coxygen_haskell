-- Définition de l'arbre binaire
data Tree a = Empty | Node a (Tree a) (Tree a)
    deriving Show

-- Définition de la monade personnalisée pour accumuler la somme
newtype SumM a = SumM { runSumM :: (a, Int) }  -- a = valeur finale, Int = somme accumulée

-- Instance Functor
instance Functor SumM where
    fmap f (SumM (x, s)) = SumM (f x, s)

-- Instance Applicative
instance Applicative SumM where
    pure x = SumM (x, 0)
    (SumM (f, s1)) <*> (SumM (x, s2)) = SumM (f x, s1 + s2)

-- Instance Monad
instance Monad SumM where
    return = pure
    (SumM (x, s1)) >>= f =
        let SumM (y, s2) = f x
        in SumM (y, s1 + s2)

-- Fonction pour ajouter une valeur à la somme
add :: Int -> SumM ()
add n = SumM ((), n)

-- Fonction pour parcourir l'arbre et calculer la somme
treeSum :: Tree Int -> SumM ()
treeSum Empty = return ()
treeSum (Node x left right) = do
    add x
    treeSum left
    treeSum right

-- Exemple d'utilisation
main :: IO ()
main = do
    let myTree = Node 5 (Node 3 Empty Empty) (Node 7 (Node 1 Empty Empty) Empty)
    let result = runSumM $ treeSum myTree
    putStrLn $ "Somme de l'arbre : " ++ show (snd result)

