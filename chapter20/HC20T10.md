{-# LANGUAGE FlexibleContexts #-}

import Control.Monad.State
import Control.Monad.Trans.Maybe

-- Type combiné : un StateT qui encapsule Maybe
type StateMaybe s a = StateT s (MaybeT IO) a

-- Exemple de fonction : incrémente l'état mais échoue si l'état devient négatif
incrementIfPositive :: StateMaybe Int ()
incrementIfPositive = do
    n <- get
    if n < 0
        then lift $ MaybeT (return Nothing)  -- échec si état négatif
        else put (n + 1)

-- Fonction pour exécuter le StateT + MaybeT
runStateMaybe :: StateMaybe s a -> s -> IO (Maybe (a, s))
runStateMaybe m st = runMaybeT (runStateT m st)

-- Exemple principal
main :: IO ()
main = do
    -- Cas succès
    res1 <- runStateMaybe incrementIfPositive 5
    print res1   -- Just ((),6)

    -- Cas échec
    res2 <- runStateMaybe incrementIfPositive (-3)
    print res2   -- Nothing

